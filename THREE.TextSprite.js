!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("three"),require("three.texttexture")):"function"==typeof define&&define.amd?define(["three","three.texttexture"],e):((t=t||self).THREE=t.THREE||{},t.THREE.TextSprite=e(t.THREE,t.THREE.TextTexture))}(this,function(t,e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var i=new t.Vector3,r=new t.Vector3,a=new t.Vector3;return function(o){function n(i){void 0===i&&(i={});var r=i.material;void 0===r&&(r={});var a=i.maxFontSize;void 0===a&&(a=1/0);var n=i.minFontSize;void 0===n&&(n=0);var s=i.redrawInterval;void 0===s&&(s=1);var p=i.textSize;void 0===p&&(p=1);var d=i.texture;void 0===d&&(d={}),o.call(this,new t.SpriteMaterial(Object.assign({},r,{map:new e(d)}))),this.lastRedraw=0,this.maxFontSize=a,this.minFontSize=n,this.redrawInterval=s,this.textSize=p}o&&(n.__proto__=o),n.prototype=Object.create(o&&o.prototype),n.prototype.constructor=n;var s={isTextSprite:{configurable:!0}};return s.isTextSprite.get=function(){return!0},n.prototype.onBeforeRender=function(t,e,i){this.redraw(t,i)},n.prototype.updateScale=function(){this.scale.set(this.material.map.imageAspect,1,1).multiplyScalar(this.textSize*this.material.map.imageHeight)},n.prototype.updateMatrix=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return this.updateScale(),o.prototype.updateMatrix.apply(this,t)},n.prototype.redraw=function(t,e){var i=this;this.lastRedraw+this.redrawInterval<Date.now()&&(this.redrawInterval?setTimeout(function(){i.redrawNow(t,e)},1):this.redrawNow(t,e))},n.prototype.redrawNow=function(e,o){this.updateScale(),this.material.map.autoRedraw=!0,this.material.map.fontSize=t.Math.clamp(t.Math.ceilPowerOfTwo(function(t,e,o){if(e.domElement.width&&e.domElement.height&&t.material.map.textLines.length){var n=t.getWorldPosition(i).distanceTo(o.getWorldPosition(r));if(n){var s=o.fov*Math.PI/180,p=2*Math.tan(s/2)*Math.abs(n),d=t.getWorldScale(a).y/p*e.domElement.height;if(d)return Math.round(d/t.material.map.imageHeight)}}return 0}(this,e,o)),this.minFontSize,this.maxFontSize),this.lastRedraw=Date.now()},n.prototype.dispose=function(){this.material.map.dispose(),this.material.dispose()},Object.defineProperties(n.prototype,s),n}(t.Sprite)});
